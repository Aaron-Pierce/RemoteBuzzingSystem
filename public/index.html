<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Remote Buzzing System</title>


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="javascripts/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="./javascripts/md5.js"></script>


</head>
<body>
<button onclick="buzz()">buzz</button>
<script>
    let socket = io();
    let uuid = md5(Math.random().toString());
    socket.on('welcome', function(){
        alert("greeted")
    });
    socket.on('lockout', function (user) {
        if(user === uuid){
            document.body.style.backgroundColor = "#5cb85c";
            document.body.innerHTML += "<h1 id='buzzAlert'>You Buzzed!</h1>";
            setTimeout(function () {

                document.body.style.backgroundColor = "white";
                document.body.removeChild(document.getElementById("buzzAlert"))
            }, 3000)
        }else{
            document.body.style.backgroundColor = "#d9534f";
            document.body.innerHTML += "<h1 id='buzzAlert'>An opponent buzzed!</h1>";
            setTimeout(function () {

                document.body.style.backgroundColor = "white";
                document.body.removeChild(document.getElementById("buzzAlert"))
            }, 3000)
        }
    });

    let lasttime = 0;
    let buzz = function(){
        socket.emit('buzz', new Date().getTime(), uuid);
        lasttime = new Date().getTime()
    };

    socket.on('return', function(time){
        console.log(lasttime - time + " roundtrip")
    });
</script>
</body>
</html>